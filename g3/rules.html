
<head><style>
    body        { background: #fff; margin-left:  40px;   font-size:  0.9em;  font-family: sans-serif; max-width: 800px; }
    h1          { background: #ffb; margin-left: -30px;   border-top:    5px  solid #ccc; }
    h2          { background: #ffb; margin-left: -20px;   border-top:    3px  solid #ddd; }
    h3          { background: #ffb; margin-left: -10px; }
    h4          { background: #ffb; }
    code        { font-size:    1.1em;  background:  #ddf; }
    pre         { margin-left:  2em;    background:  #ddf; }
    pre code    { font-size:    1.1em;  background:  #ddf; }
</style></head>

<p style="text-align:center">
    <a href="master-toc.html">master TOC</a>
|
    <a href="index.html">main page</a>
|
    <a href="index.html#license">license</a>
</p>
<h2><a name="rules"></a> access rules</h2>

<p>This is arguably the most complex part of day-to-day gitolite.  There are
several interconnected ideas that make this hard to lay out easily if you're
totally new to this, so read carefully.</p>

<p>We will use this as a running example:</p>

<pre><code>@staff          =   dilbert alice wally bob

repo foo
    RW+         =   dilbert     # line 1
    RW+ dev     =   alice       # line 2
    -           =   wally       # line 3
    RW  temp/   =   @staff      # line 4
    R           =   ashok       # line 5
</code></pre>

<h3>when does gitolite check access</h3>

<p>The "pre-git" check is before git is invoked.  Gitolite knows the repo name,
user name, and attempted access (R or W), but no ref name.</p>

<p>The "update" check is only for write operations, and it is just before git
updates a ref.  This time gitolite knows the refname also.</p>

<h3>how is a particular rule line matched</h3>

<p>For the <strong>pre-git check</strong>, any permission that contains "R" matches a read
operation, and any permission that contains "W" matches a write operation.
This is because we simply don't know enough to make finer distinctions at this
point.</p>

<p>In addition, <em>gitolite ignores deny rules during the pre-git check</em>.  <font
color="gray">(You can <a href="misc.html#deny-rules">change this</a> if you wish, though it's
rarely needed)</font>.  This means line 3 is ignored, and so Wally in our
example will pass the pre-git check.</p>

<p>For the <strong>update check</strong>, git gives us all the information we need.  Then:</p>

<ul>
<li><p>all the rules for a repo are <a href="misc.html#rule-accum">accumulated</a></p></li>
<li><p>then the rules pertaining to this repo <em>and</em> this user (or to a group to
which they belong, respectively) are kept; the rest are ignored</p></li>
<li><p>these rules are examined <em>in the sequence they appeared in the conf file</em>.
For each rule:</p>

<ul>
<li>if the ref does not match the <a href="refex.html#refex">refex</a>, the rule is skipped</li>
<li>if it's a deny rule (the permissions field is a <code>-</code>), access is
<strong>rejected</strong> and the matching stops</li>
<li>if the permission field matches the specific <a href="write-types.html#write-types">type of
write</a> operation, access is <strong>allowed</strong> and the matching
stops</li>
</ul></li>
<li><p>if no rule ends with a decision, ("fallthru"), access is <strong>rejected</strong>.</p></li>
</ul>

<p>Now you need to understand how <a href="refex.html#refex">refex</a> matching happens and how the
permissions match the various <a href="write-types.html#write-types">types of write operations</a>.</p>

<p>Using these, you can see, in our example, that:</p>

<ul>
<li>everyone, even wally, can read the repo.</li>
<li>dilbert can push, rewind, or delete any ref.</li>
<li>alice can push, rewind, or delete any ref whose name starts with 'dev';
see <a href="refex.html#refex">refex</a> for details.</li>
<li>alice can also push (but not rewind or delete) any ref whose name starts
with 'temp/'.  This applies to bob also.</li>
<li>if it weren't for line 3, the previous statement would apply to wally
also.</li>
</ul>

<p>Interestingly, wally can get past the pre-git check because gitolite ignores
deny rules for pre-git, but having got past it, he can't actually do anything.
That's by design, and as I said if you don't like it you can ask gitolite to
<a href="misc.html#deny-rules">deny at pre-git</a>.</p>

<h3>summary of permissions</h3>

<p>The full set of permissions, in regex syntax: <code>-|R|RW+?C?D?M?</code>.  This expands
to one of <code>-</code>, <code>R</code>, <code>RW</code>, <code>RW+</code>, <code>RWC</code>, <code>RW+C</code>, <code>RWD</code>, <code>RW+D</code>, <code>RWCD</code>, or
<code>RW+CD</code>, all but the first one optionally followed by an <code>M</code>.  And by now you
know what they all mean.</p>
